@model IEnumerable<CinemaApp.Models.Movie>

@{
    ViewData["Title"] = "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å–º–∞–º–∏";
    var movies = Model?.OrderByDescending(m => m.CreatedAt).ToList() ?? new List<CinemaApp.Models.Movie>();
    var totalCount = movies.Count;
    var activeCount = movies.Count(m => m.IsActive);
    var inactiveCount = totalCount - activeCount;
    var averageDuration = movies.Any() ? (int)Math.Round(movies.Average(m => m.Duration)) : 0;
    var latestMovie = movies.FirstOrDefault();
    var culture = new System.Globalization.CultureInfo("ru-RU");
}

<div class="fade-in">
    <div class="admin-page__header">
        <div class="admin-page__heading">
            <h1 class="mb-0">–ö–∞—Ç–∞–ª–æ–≥ —Ñ–∏–ª—å–º–æ–≤</h1>
            <p class="admin-page__subtitle">
                –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∞—Ñ–∏—à–µ–π: –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏, –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∏–ª–∏ –∞—Ä—Ö–∏–≤–∏—Ä—É–π—Ç–µ —Ä–µ–ª–∏–∑—ã. –ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ —Ñ–∏–ª—å–º—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è —Å–µ–∞–Ω—Å–æ–≤.
            </p>
        </div>
        <a asp-action="CreateMovie" class="btn btn-primary">
            <i class="bi bi-plus-lg me-2"></i>
            –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º
        </a>
    </div>

    @if (movies.Any())
    {
        <div class="admin-stats">
            <div class="admin-stats__card">
                <div class="admin-stats__title">–í—Å–µ–≥–æ —Ñ–∏–ª—å–º–æ–≤</div>
                <div class="admin-stats__value">@totalCount</div>
                <div class="admin-stats__meta">@activeCount –∞–∫—Ç–∏–≤@(activeCount == 1 ? "–µ–Ω" : "–Ω—ã—Ö"), @inactiveCount –≤ –∞—Ä—Ö–∏–≤–µ</div>
            </div>
            <div class="admin-stats__card">
                <div class="admin-stats__title">–°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
                <div class="admin-stats__value">
                    @averageDuration<span class="fs-6">–º–∏–Ω</span>
                </div>
                <div class="admin-stats__meta">–ú–∏–Ω–∏–º—É–º @movies.Min(m => m.Duration) –º–∏–Ω ‚Ä¢ –º–∞–∫—Å–∏–º—É–º @movies.Max(m => m.Duration) –º–∏–Ω</div>
            </div>
            <div class="admin-stats__card">
                <div class="admin-stats__title">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</div>
                <div class="admin-stats__value">
                    @(latestMovie?.CreatedAt.ToString("dd MMM", culture) ?? "‚Äî")
                </div>
                <div class="admin-stats__meta">
                    @(latestMovie != null ? latestMovie.Title : "–ù–µ—Ç –Ω–æ–≤—ã—Ö —Ñ–∏–ª—å–º–æ–≤")
                </div>
            </div>
        </div>

        <div class="admin-table__wrapper">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>–§–∏–ª—å–º</th>
                        <th>–ñ–∞–Ω—Ä</th>
                        <th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
                        <th>–ú–µ–¥–∏–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var movie in movies)
                    {
                        var hasPoster = !string.IsNullOrWhiteSpace(movie.PosterUrl);
                        var hasTrailer = !string.IsNullOrWhiteSpace(movie.TrailerUrl);
                        <tr>
                            <td>
                                <div class="admin-table__title">
                                    <span>@movie.Title</span>
                                    <span class="admin-table__meta">
                                        –î–æ–±–∞–≤–ª–µ–Ω @movie.CreatedAt.ToString("dd MMMM yyyy", culture)
                                    </span>
                                </div>
                            </td>
                            <td>
                                <span class="admin-badge">
                                    <i class="bi bi-collection-play"></i>
                                    @(string.IsNullOrWhiteSpace(movie.Genre) ? "–ù–µ —É–∫–∞–∑–∞–Ω" : movie.Genre)
                                </span>
                            </td>
                            <td>
                                <div class="admin-media">
                                    <i class="bi bi-clock-history"></i>
                                    @movie.Duration<span class="ms-1">–º–∏–Ω</span>
                                </div>
                            </td>
                            <td>
                                <div class="d-flex flex-wrap gap-2">
                                    <span class="admin-badge @(hasPoster ? "admin-badge--positive" : "admin-badge--negative")">
                                        <i class="bi bi-image"></i>
                                        @(hasPoster ? "–ü–æ—Å—Ç–µ—Ä –µ—Å—Ç—å" : "–ù–µ—Ç –ø–æ—Å—Ç–µ—Ä–∞")
                                    </span>
                                    <span class="admin-badge @(hasTrailer ? "admin-badge--positive" : "admin-badge--negative")">
                                        <i class="bi @(hasTrailer ? "bi-play-circle-fill" : "bi-pause-circle")"></i>
                                        @(hasTrailer ? "–¢—Ä–µ–π–ª–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω" : "–ë–µ–∑ —Ç—Ä–µ–π–ª–µ—Ä–∞")
                                    </span>
                                </div>
                            </td>
                            <td>
                                <span class="admin-status @(movie.IsActive ? "admin-status--active" : "admin-status--inactive")">
                                    <i class="bi @(movie.IsActive ? "bi-check-circle-fill" : "bi-dash-circle")"></i>
                                    @(movie.IsActive ? "–í –ø—Ä–æ–∫–∞—Ç–µ" : "–ê—Ä—Ö–∏–≤")
                                </span>
                            </td>
                            <td class="text-end">
                                <div class="admin-table__actions">
                                    <a asp-action="EditMovie"
                                       asp-route-id="@movie.Id"
                                       class="btn btn-outline-warning btn-sm">
                                        <i class="bi bi-pencil-square me-1"></i>
                                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </a>
                                    <form asp-action="DeleteMovie"
                                          asp-route-id="@movie.Id"
                                          method="post"
                                          class="d-inline"
                                          onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å–º ¬´@movie.Title¬ª?');">
                                        <button type="submit" class="btn btn-outline-danger btn-sm">
                                            <i class="bi bi-trash3 me-1"></i>
                                            –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="admin-empty text-center">
            <div class="admin-empty__icon">üçø</div>
            <h4 class="mb-2">–ö–∞—Ç–∞–ª–æ–≥ –ø—É—Å—Ç</h4>
            <p class="admin-empty__text">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ñ–∏–ª—å–º, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ –∞—Ñ–∏—à—É.</p>
            <a asp-action="CreateMovie" class="btn btn-primary mt-3">
                <i class="bi bi-plus-lg me-2"></i>
                –°–æ–∑–¥–∞—Ç—å —Ñ–∏–ª—å–º
            </a>
        </div>
    }
</div>
